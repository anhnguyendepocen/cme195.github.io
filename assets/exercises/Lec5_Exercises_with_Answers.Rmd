---
title: "Lecture 5: Exercises with answers"
date: October 11th, 2017
output: 
  html_notebook:
    toc: true
    toc_float: true
---


# Exercise 1: Data Manipulation

## Part 1: `purrr` package

## Part 2: Merging

## Part 3: Export datasets

Consider the two data-frames below:


a. Merge the two data tables so that you have all the entries from dataset 
'election' but for each candidate you have personal information added.

Merge 'personal' to 'elections' the two data tables using `left_join()`


Observe what happened to the "year" columns.

Note also, that this did not quite get a reasonable result as `left_join()`
by default merges two tables by ALL shared variables, so in this case
"name" AND "year". However, "year" in two data-frames here mean two different 
things, one is the election year and the other is the year married.
What we really want is to **merge by** "name" only.

```{r}
# Note that you need to use QUOTATION marks
elections %>% left_join(personal, by = "name")
```

We can do the reverse operatio and merge 'elections' to 'personal':

```{r}
# Note that this gives you fewer rows:
personal %>% left_join(elections, by = "name")
```

b. Imagine that you have two data-frames where the columns you want to merge
by do not share the same name like in the example below. Try to merge
the two datasets now, by using appropriate input arguments to `left_join()`.

# Exercise 2: Exploratory Data Analysis

Task: relationship between distance and average delay for each location.

```{r}
by_dest <- group_by(flights, dest)
delay <- summarise(by_dest,
  count = n(),                 # Count the number of occurrences
  dist = mean(distance, na.rm = TRUE),
  delay = mean(arr_delay, na.rm = TRUE) )
delay <- filter(delay, count > 20, dest != "HNL")
```

It looks like delays increase
with distance up to ~750 miles
and then decrease.

```{r}
ggplot(delay, 
  aes(x=dist, y=delay)) +
  geom_point(aes(size=count),
             alpha=1/3) +
  geom_smooth(se = FALSE)

```


## Understanding missing values

What makes observations with missing values different?

For example, in flights, missing dep_time for cancelled flights.

Compare scheduled departure times for cancelled and non-cancelled times.

```{r}
nycflights13::flights %>% mutate(cancelled = is.na(dep_time),
    sched_hour=sched_dep_time%/%100, sched_min=sched_dep_time%%100,
    sched_dep_time=sched_hour+sched_min/60
  ) %>% ggplot(aes(sched_dep_time)) + scale_y_log10() + 
    geom_freqpoly(aes(color=cancelled), binwidth=1/4)
```


# Exercise 3: Interactive graphics with `plotly`

First generate the following (x,y,z) coordinates for your scatter 3D plot:
```{r}
library(plotly)

theta <- 2*pi * runif(1000)
phi <- pi * runif(1000)
x <- sin(phi) * cos(theta)
y <- sin(phi) * sin(theta)
z <- cos(phi)
dat <- data.frame(x, y, z)
```

a. Generate a scatter plot with (x, y, z) coordinates, just computed. What do
you observe?

```{r}
plot_ly(dat, x = ~x, y = ~y, z = ~z,
        type = "scatter3d", mode = "markers", marker = list(size = 3))
```

b. Now generate new points as follows. And use `plotly` to create a 3D 
scatter point plot and a separate line plot. Color the points by
their ordering in the data-frame.

```{r}
N <- 10
theta <- rep(2*pi * seq(0, 1, length.out = 100), N)
phi <- rep(pi * seq(0, 1, length.out = N*100))
x <- sin(phi) * cos(theta)
y <- sin(phi) * sin(theta)
z <- cos(phi)
dat <- data.frame(x, y, z)
```


```{r}
plot_ly(dat, x = ~x, y = ~y, z = ~z, color = 1:1000) %>%
  add_markers(marker = list(size = 2))
```

```{r}
plot_ly(dat, x = ~x, y = ~y, z = ~z, color = 1:1000, type = "scatter3d", 
        mode = "lines", line = list(width = 3))
```




